<?xml version="1.0" encoding="utf-8"?>
<project name="Backpack" basedir="."
         default="build.all"
>
    <dirname property="backpack.basedir" file="${ant.file.Backpack}" />
<!--
    property definitions
-->
    <property name="backpack.src.dir" value="${backpack.basedir}/../src" />
    <property name="backpack.output.dir" value="${backpack.basedir}/../build" />

    <condition 
        property="project.src.dir"
        value="${project.dir}"
        else="${backpack.basedir}/../project/"
    >
        <isset property="project.dir" />
    </condition>
    <property name="project.build.filelist" value="${project.src.dir}/build.filelist" />

<!--
    default target
-->
    <target name="backpack.core.build"
            description="Builds Backpack"
    >
            <echo message="Building Backpack" />
            <echo message="${project.src.dir}" />
            <concat destfile="${backpack.output.dir}/backpack.js">
                <filelist dir="${backpack.src.dir}">
                    <file name="backpack.core.js" />
                    <file name="backpack.util.js" />

                    <file name="backpack.slideBar.js" />
                    <file name="backpack.statusBar.js" />
                    
                    <file name="backpack.mixins.js" />

                    <file name="backpack.init.js" />
<!--                     <file name="backpack.run.js" /> -->
                </filelist>

                <fileset dir="${project.src.dir}" includesfile="${project.build.filelist}" />
            </concat>
    </target>

    <target name="build.all"
            description="Builds Backpack."
            depends="backpack.core.build"
    />

    <target name="test"
            description="Test build"
    >
        <echo message="Running tests" />
        <java jar="${backpack.test.rhino}"
            fork="true"
        >
            <arg value="${backpack.test.runner}" />
        </java>
        <echo message="Testing complete" />
    </target>
</project>
